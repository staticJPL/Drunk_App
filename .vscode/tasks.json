{
  "version": "2.0.0",
  "inputs": [
    {
      "id": "drunkPiSshKey",
      "type": "promptString",
      "description": "Full path to your SSH private key (e.g. ~/.ssh/id_rsa)",
      "default": "~/.ssh/id_rsa"
    },
    {
      "id": "drunkPiHost",
      "type": "promptString",
      "description": "SSH host for the Pi (e.g. pi@Hostname)",
      "default": "pi@Hostname"
    },
    {
      "id": "drunkRemoteRepo",
      "type": "promptString",
      "description": "Remote repo path on the Pi",
      "default": "/home/pi/Drunk_App"
    }
  ],
  "tasks": [
    {
      "label": "Pi: Build drunk_app (Clang ASan+UBSan)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "cd \"${workspaceFolder}\" && rsync -az --delete --exclude .clang-tidy --exclude build --exclude build-wsl --exclude .git -e \"ssh -i ${input:drunkPiSshKey}\" ./ ${input:drunkPiHost}:${input:drunkRemoteRepo}/ && ssh -i ${input:drunkPiSshKey} ${input:drunkPiHost} -- bash -lc \"hostname; cd ${input:drunkRemoteRepo} && cmake -S . -B build-clang-asan -DCMAKE_BUILD_TYPE=Debug -DCMAKE_C_COMPILER=clang -DCMAKE_CXX_COMPILER=clang++ -DDRUNK_ENABLE_ASAN=ON -DDRUNK_ENABLE_UBSAN=ON && cmake --build build-clang-asan -j\""
      ],
      "problemMatcher": []
    },
    {
      "label": "Pi: Build drunk_app (GCC Debug)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "cd \"${workspaceFolder}\" && rsync -az --delete --exclude .clang-tidy --exclude build --exclude build-wsl --exclude .git -e \"ssh -i ${input:drunkPiSshKey}\" ./ ${input:drunkPiHost}:${input:drunkRemoteRepo}/ && ssh -i ${input:drunkPiSshKey} ${input:drunkPiHost} -- bash -lc \"hostname; cd ${input:drunkRemoteRepo} && cmake -S . -B build-debug -DCMAKE_BUILD_TYPE=Debug && cmake --build build-debug -j\""
      ],
      "problemMatcher": []
    },
    {
      "label": "Pi: Build drunk_app (GCC Release)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "cd \"${workspaceFolder}\" && rsync -az --delete --exclude .clang-tidy --exclude build --exclude build-wsl --exclude .git -e \"ssh -i ${input:drunkPiSshKey}\" ./ ${input:drunkPiHost}:${input:drunkRemoteRepo}/ && ssh -i ${input:drunkPiSshKey} ${input:drunkPiHost} -- bash -lc \"hostname; cd ${input:drunkRemoteRepo} && cmake -S . -B build-release -DCMAKE_BUILD_TYPE=Release && cmake --build build-release -j\""
      ],
      "problemMatcher": []
    },
    {
      "label": "Pi: Build drunk_app (Default)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "cd \"${workspaceFolder}\" && rsync -az --delete --exclude .clang-tidy --exclude build --exclude build-wsl --exclude .git -e \"ssh -i ${input:drunkPiSshKey}\" ./ ${input:drunkPiHost}:${input:drunkRemoteRepo}/ && ssh -i ${input:drunkPiSshKey} ${input:drunkPiHost} -- bash -lc \"hostname; cd ${input:drunkRemoteRepo} && cmake -S . -B build && cmake --build build -j\""
      ],
      "problemMatcher": [],
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },
    {
      "label": "Pi: Run drunk_app (Build)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "ssh -i ${input:drunkPiSshKey} ${input:drunkPiHost} \"cd ${input:drunkRemoteRepo} && ./build/drunk_app\""
      ],
      "problemMatcher": [],
      "group": {
        "kind": "test",
        "isDefault": true
      }
    },
    {
      "label": "Pi: Run drunk_app (Debug)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "ssh -i ${input:drunkPiSshKey} ${input:drunkPiHost} \"cd ${input:drunkRemoteRepo} && ./build-debug/drunk_app\""
      ],
      "problemMatcher": [],
      "group": {
        "kind": "test",
        "isDefault": true
      }
    },
    {
      "label": "Pi: Kill drunk_app",
      "type": "shell",
      "command": "bash",
      "args": [
        "-lc",
        "ssh -i ${input:drunkPiSshKey} ${input:drunkPiHost} \"pkill -SIGTERM drunk_app; sleep 0.3; pgrep drunk_app >/dev/null && pkill -9 drunk_app || true\""
      ],
      "problemMatcher": []
    }
  ]
}
